<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portfolio (Drive Folder Images)</title>
  <style>
    body {margin:0; font:16px/1.6 system-ui, "Noto Sans KR", sans-serif; background:#fff; color:#111;}
    header {position:sticky; top:0; background:#fffccfdd; padding:12px 16px; border-bottom:1px solid #eee;}
    .grid {display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:16px; padding:16px;}
    .card {border:1px solid #eee; border-radius:14px; overflow:hidden; background:#fff; box-shadow:0 1px 6px rgba(0,0,0,.06);}
    .viewer {aspect-ratio:4/3; display:flex; align-items:center; justify-content:center; background:#fafafa;}
    .viewer img {max-width:100%; max-height:100%; display:block;}
    .title {font-size:14px; margin:10px 12px 0 12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .meta {font-size:12px; color:#666; margin:8px 12px 12px 12px;}
  </style>
</head>
<body>
  <header>
    <strong>Portfolio</strong>
    <span id="count" style="font-size:12px; margin-left:8px; color:#666"></span>
  </header>

  <div id="grid" class="grid"></div>

  <script>
    // ⬇⬇⬇ 여기를 당신 값으로 바꾸세요 ⬇⬇⬇
    const FOLDER_ID = "16gMlYIDC3q95nhb1GhS-cNYkgRBBJPeu"; // 구글드라이브 폴더 ID
    const API_KEY   = "AIzaSyCev_s9YpQIJvJlBRNkNpRFrDsSpxsZXnQ";          // 구글클라우드에서 발급한 API Key
    // ⬆⬆⬆ ⬆⬆⬆
// ✅ 올바른 드라이브 파일 리스트 API 엔드포인트
        const DRIVE_LIST = "https://www.googleapis.com/drive/v3/files";

    const DRIVE_THUMB = (id) => `https://drive.google.com/uc?export=view&id=${id}`;

    async function listImageFilesInFolder(folderId, pageToken=null) {
      const params = new URLSearchParams({
        q: `'${folderId}' in parents and trashed=false and (mimeType contains 'image/')`,
        pageSize: "1000",
        fields: "nextPageToken, files(id,name,mimeType,modifiedTime,size)",
        key: API_KEY
      });
      if (pageToken) params.set("pageToken", pageToken);

      const res = await fetch(`${DRIVE_LIST}?${params.toString()}`);
      if (!res.ok) throw new Error("files.list 실패: " + res.status + " " + (await res.text()));
      return res.json();
    }

    async function listAllImages(folderId) {
      let all = [];
      let token = null;
      do {
        const data = await listImageFilesInFolder(folderId, token);
        all = all.concat(data.files || []);
        token = data.nextPageToken || null;
      } while (token);
      return all;
    }

  function makeCard(file) {
  const card = document.createElement('div');
  card.className = 'card';
  const viewer = document.createElement('div');
  viewer.className = 'viewer';

  if (file.mimeType === "image/png" || file.mimeType === "image/jpeg") {
    const img = document.createElement('img');
    img.src = `https://www.googleapis.com/drive/v3/files/${file.id}?alt=media&key=${API_KEY}`;
    img.alt = file.name;
    viewer.appendChild(img);
  } else {
    const link = document.createElement('a');
    link.href = `https://drive.google.com/uc?export=download&id=${file.id}`;
    link.textContent = "Download PSD";
    link.target = "_blank";
    viewer.appendChild(link);
  }

  const title = document.createElement('div');
  title.className = 'title';
  title.textContent = file.name;
  card.appendChild(viewer);
  card.appendChild(title);
  return card;
}


    async function load() {
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      try {
        const files = await listAllImages(FOLDER_ID);
        document.getElementById('count').textContent = `${files.length} images`;
        files.sort((a,b)=>a.name.localeCompare(b.name,'en'));
        for (const f of files) grid.appendChild(makeCard(f));
        if (files.length === 0) {
          grid.textContent = "폴더에 PNG/JPG 이미지가 없거나 공개 범위가 올바르지 않습니다.";
        }
      } catch (e) {
        grid.textContent = "로딩 오류: " + e.message;
      }
    }
    load();
    
    async function listImageFilesInFolder(folderId, pageToken=null) {
  const params = new URLSearchParams({
    q: `'${folderId}' in parents and trashed=false and (mimeType='image/png' or mimeType='image/jpeg')`,
    pageSize: "1000",
    fields: "nextPageToken, files(id,name,mimeType,modifiedTime,size)",
    key: API_KEY
  });
  if (pageToken) params.set("pageToken", pageToken);

  const res = await fetch(`${DRIVE_LIST}?${params.toString()}`);
  if (!res.ok) throw new Error("files.list 실패: " + res.status + " " + (await res.text()));
  return res.json();
}

  </script>
</body>
</html>
